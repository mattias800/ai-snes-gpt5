<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SNES (SMW) Web Harness</title>
    <style>
      :root { color-scheme: dark light; }
      body { font-family: system-ui, sans-serif; margin: 0; padding: 16px; }
      header { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
      #controls { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
      #screen { image-rendering: pixelated; image-rendering: crisp-edges; background: #000; }
      .row { margin-top: 8px; display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
      label { display: inline-flex; align-items: center; gap: 6px; }
      #log { white-space: pre-wrap; font-family: ui-monospace, Menlo, monospace; font-size: 12px; opacity: 0.8; }
      .spacer { flex: 1 1 auto; }
      .muted { opacity: 0.7; }
      .small { font-size: 12px; }
    </style>
  </head>
  <body>
    <header>
      <h2 style="margin: 0">SNES Web Harness</h2>
      <div class="spacer"></div>
      <a class="small" href="https://github.com/" target="_blank" rel="noreferrer noopener">repo</a>
    </header>

    <div id="controls" class="row">
      <label>
        ROM
        <input type="file" id="romFile" accept=".sfc,.smc,.bin,.zip,.fig,.u1,.u2,.u3,.u4,.u5,.u6" />
      </label>
      <label title="Instructions per scanline for the scheduler">
        IPS
        <input type="number" id="ips" value="800" min="50" max="5000" step="50" />
      </label>
      <label title="Canvas CSS scale">
        Scale
        <input type="number" id="scale" value="3" min="1" max="6" step="1" />
      </label>
      <label title="Enable real APU core (bypasses shim)">
        <input type="checkbox" id="apuCore" /> APU core
      </label>
      <label title="Use APU shim to pass handshake and (optionally) unblank (ignored if APU core enabled)">
        <input type="checkbox" id="shim" checked /> Shim
      </label>
      <label title="Shim performs only handshake (no PPU writes)">
        <input type="checkbox" id="shimOnly" checked /> Handshake-only
      </label>
      <label title="Shim injects a test tile/palette after countdown (for quick visuals)">
        <input type="checkbox" id="shimTile" /> Shim tile
      </label>
    </div>

    <div class="row">
      <label title="APU boot-time IPL HLE: CPU<->APU handshake/upload shim">
        <input type="checkbox" id="apuIplHle" /> APU IPL-HLE
      </label>
      <label title="HLE null IRQ vector: if IRQ/BRK vector=$FFFF, do immediate RETI">
        <input type="checkbox" id="nullIrqIplHle" checked /> Null IRQ IPL-HLE
      </label>
      <label title="Rewrite a RETI stub into ARAM when IRQ/BRK vector=$FFFF (SPC loader use)">
        <input type="checkbox" id="rewriteNullIrq" /> Rewrite null IRQ vector
      </label>
      <button id="resetBtn" disabled>Reset</button>
      <button id="pauseBtn" disabled>Pause</button>
      <button id="saveBtn" disabled title="Download current frame as a 256x224 PNG">Save PNG</button>
      <span id="status" class="small muted">No ROM loaded</span>
    </div>

    <div class="row">
      <canvas id="screen" width="256" height="224"></canvas>
    </div>

    <div id="log" class="row muted small"></div>

    <script type="module" src="/main.ts"></script>
  </body>
</html>

